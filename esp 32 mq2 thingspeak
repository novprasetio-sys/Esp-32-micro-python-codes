import machine
import time
import network
import urequests

# Inisialisasi pin
mq2 = machine.ADC(machine.Pin(34))  # Pin analog untuk sensor MQ2

# Inisialisasi WiFi
wifi = network.WLAN(network.STA_IF)
wifi.active(True)
wifi.connect('SSID', 'PASSWORD')

# Inisialisasi Thingspeak
thingspeak_api_key = 'YOUR_API_KEY'
thingspeak_url = 'https://api.thingspeak.com/update?api_key=' + thingspeak_api_key

def mq2_adc_to_state(adc_value):
    if adc_value < 20000:
        return 1  # Aman
    elif adc_value < 40000:
        return 2  # Berpotensi meledak
    else:
        return 3  # Bahaya

def get_mq2_state():
    adc_value = mq2.read()
    state = mq2_adc_to_state(adc_value)
    return state

while True:
    state = get_mq2_state()
    urequests.get(thingspeak_url + '&field1=' + str(state))
    time.sleep(15)